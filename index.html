<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bonbons de Pinchat — Snacks & Livraison locale</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="min-h-screen bg-slate-50 text-slate-900">
    <header class="sticky top-0 z-30 bg-white/85 backdrop-blur border-b border-slate-200">
      <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-2xl bg-slate-900 text-white grid place-items-center font-semibold">
            BP
          </div>
          <div class="leading-tight">
            <div class="text-base font-semibold">Bonbons de Pinchat</div>
            <div class="text-xs text-slate-500">Snacks — Livraison locale</div>
          </div>
        </div>

        <a
          href="#catalogue"
          class="inline-flex items-center justify-center rounded-xl px-3 py-2 text-sm font-medium bg-slate-900 text-white hover:bg-slate-800 active:bg-slate-900"
        >
          Voir le catalogue
        </a>
      </div>
    </header>

    <main class="mx-auto max-w-6xl px-4 py-8">
      <section class="mb-8">
        <div class="rounded-2xl border border-amber-200 bg-amber-50 p-5">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <h1 class="text-xl sm:text-2xl font-semibold tracking-tight">Livraison locale rapide</h1>
              <p class="mt-2 text-sm text-slate-700">
                Livraison exclusivement pour les élèves de Pinchat et les habitants des Acacias, Carouge et zones
                environnantes.
              </p>
            </div>

            <div class="mt-3 sm:mt-0 text-sm font-medium text-slate-900">
              Paiement en espèces uniquement à la livraison
            </div>
          </div>

          <div class="mt-5 grid gap-4 md:grid-cols-12">
            <div class="md:col-span-7">
              <div class="rounded-2xl bg-white border border-slate-200 p-4">
                <div class="flex items-center justify-between gap-3">
                  <div>
                    <div class="text-sm font-semibold">Zone de livraison (obligatoire)</div>
                    <div class="text-xs text-slate-500">Les frais sont calculés automatiquement.</div>
                  </div>
                  <div id="feeBadge" class="hidden text-xs font-semibold px-2.5 py-1 rounded-full bg-slate-900 text-white">
                    —
                  </div>
                </div>

                <div class="mt-3">
                  <label for="zone" class="sr-only">Sélectionner une zone</label>
                  <select
                    id="zone"
                    class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-slate-900/20 focus:border-slate-400"
                    required
                  >
                    <option value="" selected disabled>Sélectionnez votre zone</option>
                    <option value="standard">Standard (Pinchat, Acacias, Carouge, etc.) — 2 CHF</option>
                    <option value="vessy">Vessy — 3 CHF</option>
                  </select>

                  <div id="zoneHint" class="mt-2 text-xs text-slate-500">
                    Veuillez sélectionner une zone pour activer le calcul du total final.
                  </div>
                </div>
              </div>
            </div>

            <div class="md:col-span-5">
              <div class="rounded-2xl bg-white border border-slate-200 p-4">
                <div class="flex items-center justify-between">
                  <div class="text-sm font-semibold">Récapitulatif</div>
                  <button
                    id="clearBtn"
                    type="button"
                    class="text-xs font-medium text-slate-600 hover:text-slate-900"
                  >
                    Vider
                  </button>
                </div>

                <div id="cartEmpty" class="mt-3 text-sm text-slate-600">
                  Votre panier est vide.
                </div>

                <div id="cartList" class="mt-3 hidden">
                  <ul id="cartItems" class="space-y-2"></ul>
                </div>

                <div class="mt-4 border-t border-slate-200 pt-4 space-y-2 text-sm">
                  <div class="flex items-center justify-between">
                    <span class="text-slate-600">Sous-total</span>
                    <span id="subtotal" class="font-semibold">0.00 CHF</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="text-slate-600">Frais de livraison</span>
                    <span id="deliveryFee" class="font-semibold">—</span>
                  </div>
                  <div class="flex items-center justify-between text-base">
                    <span class="font-semibold">Total</span>
                    <span id="total" class="font-semibold">—</span>
                  </div>

                  <button
                    id="orderBtn"
                    type="button"
                    class="mt-3 w-full inline-flex items-center justify-center rounded-xl px-4 py-3 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800 active:bg-slate-900 disabled:opacity-40 disabled:cursor-not-allowed"
                    disabled
                  >
                    Commander
                  </button>

                  <div id="orderHint" class="text-xs text-slate-500">
                    Ajoutez des articles et sélectionnez une zone pour commander.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="catalogue" class="mb-10">
        <div class="flex items-end justify-between gap-3">
          <div>
            <h2 class="text-lg sm:text-xl font-semibold tracking-tight">Catalogue</h2>
            <p class="mt-1 text-sm text-slate-600">Sélectionnez vos articles, puis finalisez la commande.</p>
          </div>
        </div>

        <div id="productsGrid" class="mt-5 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
      </section>

      <section class="pb-10">
        <div class="rounded-2xl border border-slate-200 bg-white p-5">
          <div class="text-sm font-semibold">Informations importantes</div>
          <ul class="mt-2 text-sm text-slate-700 list-disc pl-5 space-y-1">
            <li>Livraison exclusivement pour les élèves de Pinchat et les habitants des Acacias, Carouge et zones environnantes.</li>
            <li>Zone obligatoire : Standard (2 CHF) ou Vessy (3 CHF).</li>
            <li>Paiement en espèces uniquement à la livraison.</li>
          </ul>
        </div>
      </section>
    </main>

    <footer class="border-t border-slate-200 bg-white">
      <div class="mx-auto max-w-6xl px-4 py-8 text-sm text-slate-600">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <div>© <span id="year"></span> Bonbons de Pinchat</div>
          <div class="text-xs text-slate-500">Site one-page optimisé pour mobile — GitHub Pages</div>
        </div>
      </div>
    </footer>

    <script>
      const FORM_BASE =
        "https://docs.google.com/forms/d/e/1FAIpQLSfWW2GXxYsCjU82BkPRLCbL4WDVrbZ8qsL5juSXr-msIsoE_A/viewform";

      const FORM_FIELDS = {
        order: "entry.1111111111",
        total: "entry.2222222222",
        zone: "entry.3333333333",
      };

      const ZONES = [
        { id: "standard", label: "Standard (Pinchat, Acacias, Carouge, etc.)", fee: 2 },
        { id: "vessy", label: "Vessy", fee: 3 },
      ];

      const CATALOGUE = [
        {
          id: "katjes_200",
          nom: "Katjes 200g",
          prix: 5,
          image:
            "https://static01.galaxus.com/productimages/5/9/8/5/7/8/7/1/2/4/4/9/8/3/9/3/6/2/6/28cc3980-3257-4af3-9dca-5643999ce563_cropped.jpg_720.avif",
        },
        {
          id: "katjes_100",
          nom: "Katjes 100g",
          prix: 3,
          image: "https://assets.brack.ch/images2/6/9/7/188883796/188883796_xxl.jpg",
        },
      ];

      const els = {
        zone: document.getElementById("zone"),
        feeBadge: document.getElementById("feeBadge"),
        zoneHint: document.getElementById("zoneHint"),
        productsGrid: document.getElementById("productsGrid"),
        cartEmpty: document.getElementById("cartEmpty"),
        cartList: document.getElementById("cartList"),
        cartItems: document.getElementById("cartItems"),
        subtotal: document.getElementById("subtotal"),
        deliveryFee: document.getElementById("deliveryFee"),
        total: document.getElementById("total"),
        orderBtn: document.getElementById("orderBtn"),
        orderHint: document.getElementById("orderHint"),
        clearBtn: document.getElementById("clearBtn"),
        year: document.getElementById("year"),
      };

      const state = {
        zoneId: "",
        cart: new Map(),
      };

      const chf = (n) => `${n.toFixed(2)} CHF`;

      const getZone = (id) => ZONES.find((z) => z.id === id) || null;

      const cartToLines = () => {
        const lines = [];
        for (const [id, qty] of state.cart.entries()) {
          const p = CATALOGUE.find((x) => x.id === id);
          if (!p) continue;
          lines.push(`${p.nom} x${qty} (${p.prix} CHF)`);
        }
        return lines;
      };

      const calcSubtotal = () => {
        let s = 0;
        for (const [id, qty] of state.cart.entries()) {
          const p = CATALOGUE.find((x) => x.id === id);
          if (!p) continue;
          s += p.prix * qty;
        }
        return s;
      };

      const buildFormUrl = ({ orderText, total, zoneLabel }) => {
        const u = new URL(FORM_BASE);
        u.searchParams.set("usp", "pp_url");

        u.searchParams.set("order", orderText);
        u.searchParams.set("total", `${total.toFixed(2)} CHF`);
        u.searchParams.set("zone", zoneLabel);

        if (FORM_FIELDS.order) u.searchParams.set(FORM_FIELDS.order, orderText);
        if (FORM_FIELDS.total) u.searchParams.set(FORM_FIELDS.total, `${total.toFixed(2)} CHF`);
        if (FORM_FIELDS.zone) u.searchParams.set(FORM_FIELDS.zone, zoneLabel);

        return u.toString();
      };

      const renderProducts = () => {
        els.productsGrid.innerHTML = "";

        for (const p of CATALOGUE) {
          const card = document.createElement("article");
          card.className =
            "rounded-2xl border border-slate-200 bg-white overflow-hidden shadow-sm hover:shadow transition";

          const imgWrap = document.createElement("div");
          imgWrap.className = "aspect-[4/3] bg-slate-100 overflow-hidden";

          const img = document.createElement("img");
          img.src = p.image;
          img.alt = p.nom;
          img.loading = "lazy";
          img.className = "h-full w-full object-cover";

          imgWrap.appendChild(img);

          const body = document.createElement("div");
          body.className = "p-4";

          const titleRow = document.createElement("div");
          titleRow.className = "flex items-start justify-between gap-3";

          const name = document.createElement("h3");
          name.className = "text-sm font-semibold";
          name.textContent = p.nom;

          const price = document.createElement("div");
          price.className = "text-sm font-semibold";
          price.textContent = `${p.prix} CHF`;

          titleRow.appendChild(name);
          titleRow.appendChild(price);

          const actions = document.createElement("div");
          actions.className = "mt-4 flex items-center gap-2";

          const addBtn = document.createElement("button");
          addBtn.type = "button";
          addBtn.className =
            "w-full inline-flex items-center justify-center rounded-xl px-4 py-2.5 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800 active:bg-slate-900";
          addBtn.textContent = "Ajouter au panier";
          addBtn.addEventListener("click", () => {
            const cur = state.cart.get(p.id) || 0;
            state.cart.set(p.id, cur + 1);
            renderCart();
            updateTotals();
          });

          actions.appendChild(addBtn);

          body.appendChild(titleRow);
          body.appendChild(actions);

          card.appendChild(imgWrap);
          card.appendChild(body);

          els.productsGrid.appendChild(card);
        }
      };

      const renderCart = () => {
        const hasItems = state.cart.size > 0;

        els.cartEmpty.classList.toggle("hidden", hasItems);
        els.cartList.classList.toggle("hidden", !hasItems);

        els.cartItems.innerHTML = "";

        if (!hasItems) return;

        for (const [id, qty] of state.cart.entries()) {
          const p = CATALOGUE.find((x) => x.id === id);
          if (!p) continue;

          const li = document.createElement("li");
          li.className = "flex items-center justify-between gap-3";

          const left = document.createElement("div");
          left.className = "min-w-0";

          const line1 = document.createElement("div");
          line1.className = "text-sm font-medium truncate";
          line1.textContent = p.nom;

          const line2 = document.createElement("div");
          line2.className = "text-xs text-slate-500";
          line2.textContent = `${p.prix} CHF × ${qty}`;

          left.appendChild(line1);
          left.appendChild(line2);

          const right = document.createElement("div");
          right.className = "flex items-center gap-2";

          const minus = document.createElement("button");
          minus.type = "button";
          minus.className =
            "h-9 w-9 rounded-xl border border-slate-300 bg-white text-slate-900 hover:bg-slate-50";
          minus.textContent = "−";
          minus.addEventListener("click", () => {
            const cur = state.cart.get(id) || 0;
            const next = cur - 1;
            if (next <= 0) state.cart.delete(id);
            else state.cart.set(id, next);
            renderCart();
            updateTotals();
          });

          const qtyBadge = document.createElement("div");
          qtyBadge.className =
            "min-w-[2.25rem] text-center text-sm font-semibold rounded-xl bg-slate-100 px-2 py-2";
          qtyBadge.textContent = String(qty);

          const plus = document.createElement("button");
          plus.type = "button";
          plus.className =
            "h-9 w-9 rounded-xl border border-slate-300 bg-white text-slate-900 hover:bg-slate-50";
          plus.textContent = "+";
          plus.addEventListener("click", () => {
            const cur = state.cart.get(id) || 0;
            state.cart.set(id, cur + 1);
            renderCart();
            updateTotals();
          });

          right.appendChild(minus);
          right.appendChild(qtyBadge);
          right.appendChild(plus);

          li.appendChild(left);
          li.appendChild(right);

          els.cartItems.appendChild(li);
        }
      };

      const updateTotals = () => {
        const subtotal = calcSubtotal();
        els.subtotal.textContent = chf(subtotal);

        const zone = getZone(state.zoneId);

        if (!zone) {
          els.deliveryFee.textContent = "—";
          els.total.textContent = "—";
          els.feeBadge.classList.add("hidden");
          els.zoneHint.classList.remove("hidden");
        } else {
          els.deliveryFee.textContent = chf(zone.fee);
          els.total.textContent = chf(subtotal + zone.fee);
          els.feeBadge.textContent = `Frais : ${zone.fee} CHF`;
          els.feeBadge.classList.remove("hidden");
          els.zoneHint.classList.add("hidden");
        }

        const canOrder = state.cart.size > 0 && !!zone;
        els.orderBtn.disabled = !canOrder;

        if (!state.cart.size) {
          els.orderHint.textContent = "Ajoutez des articles et sélectionnez une zone pour commander.";
        } else if (!zone) {
          els.orderHint.textContent = "Veuillez sélectionner une zone pour calculer le total et commander.";
        } else {
          els.orderHint.textContent = "Votre commande sera transmise via Google Forms.";
        }
      };

      const handleOrder = () => {
        const zone = getZone(state.zoneId);
        if (!zone || state.cart.size === 0) return;

        const lines = cartToLines();
        const subtotal = calcSubtotal();
        const total = subtotal + zone.fee;

        const orderText =
          `Bonbons de Pinchat — Détail de la commande\n` +
          `Zone : ${zone.label}\n` +
          `Frais de livraison : ${zone.fee} CHF\n` +
          `Articles :\n- ${lines.join("\n- ")}\n` +
          `Sous-total : ${subtotal.toFixed(2)} CHF\n` +
          `Total : ${total.toFixed(2)} CHF\n` +
          `Paiement : espèces uniquement à la livraison`;

        const url = buildFormUrl({
          orderText,
          total,
          zoneLabel: zone.label,
        });

        window.open(url, "_blank", "noopener,noreferrer");
      };

      const clearCart = () => {
        state.cart.clear();
        renderCart();
        updateTotals();
      };

      els.zone.addEventListener("change", (e) => {
        state.zoneId = e.target.value;
        updateTotals();
      });

      els.orderBtn.addEventListener("click", handleOrder);
      els.clearBtn.addEventListener("click", clearCart);

      els.year.textContent = String(new Date().getFullYear());

      renderProducts();
      renderCart();
      updateTotals();
    </script>
  </body>
</html>
